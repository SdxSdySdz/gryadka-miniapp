<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ì—Ä—è–¥–∫–∞</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="../static/css/admin/admin.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="../config.js"></script>
</head>
<body>
    <div class="admin-container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="admin-header">
            <h1 class="admin-title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <p class="admin-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–æ–º –ì—Ä—è–¥–∫–∞</p>
            <a href="../index.html" class="view-as-customer-btn">
                üëÅ –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç –ª–∏—Ü–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
            </a>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
                <div class="stat-value" id="todayOrders">0</div>
                <div class="stat-change positive">+5% –∫ –≤—á–µ—Ä–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–í—ã—Ä—É—á–∫–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                <div class="stat-value" id="todayRevenue">0 ‚ÇΩ</div>
                <div class="stat-change positive">+12% –∫ –≤—á–µ—Ä–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ù–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                <div class="stat-value" id="newCustomers">0</div>
                <div class="stat-change positive">+8% –∫ –≤—á–µ—Ä–∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤</div>
                <div class="stat-value" id="activeProducts">0</div>
            </div>
        </div>

        <!-- –ú–µ–Ω—é -->
        <div class="data-table-container">
            <h2 class="section-title" style="margin-bottom: 16px;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
            <div class="menu-list">
                <a href="./categories.html" class="menu-item" style="text-decoration: none; color: inherit;">
                    <div class="menu-icon">üì¶</div>
                    <div class="menu-text">–¢–æ–≤–∞—Ä—ã –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</div>
                    <div class="menu-arrow">‚Ä∫</div>
                </a>
                <a href="./orders.html" class="menu-item" style="text-decoration: none; color: inherit;">
                    <div class="menu-icon">üõí</div>
                    <div class="menu-text">–ó–∞–∫–∞–∑—ã</div>
                    <div class="menu-arrow">‚Ä∫</div>
                </a>
                <a href="./settings.html" class="menu-item" style="text-decoration: none; color: inherit;">
                    <div class="menu-icon">‚öôÔ∏è</div>
                    <div class="menu-text">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                    <div class="menu-arrow">‚Ä∫</div>
                </a>
            </div>
        </div>

        <!-- –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è -->
        <div style="margin-top: 20px; text-align: center;">
            <div class="server-time">
                –°–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è: <span id="serverTime">--:--:--</span>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        const API_BASE_URL = window.CONFIG.API_BASE_URL;

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/admin/stats?telegram_id=${tg.initDataUnsafe.user.id}`);
                const stats = await response.json();
                
                document.getElementById('todayOrders').textContent = stats.total_orders || 0;
                document.getElementById('todayRevenue').textContent = `${stats.total_revenue?.toFixed(2) || 0} ‚ÇΩ`;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        async function updateServerTime() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/server-time`);
                const data = await response.json();
                const date = new Date(data.time);
                document.getElementById('serverTime').textContent = date.toLocaleTimeString('ru-RU');
            } catch (error) {
                console.error('Error loading time:', error);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadStats();
        updateServerTime();
        setInterval(updateServerTime, 1000);
    </script>
</body>
</html>
