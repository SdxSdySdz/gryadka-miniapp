# 📋 Техническое описание проекта "Грядка"

## 🎯 Общая информация

**Название:** Грядка - Интернет-магазин фруктов и овощей  
**Платформа:** Telegram Bot + Mini App  
**Стек:** Python, aiogram, FastAPI, SQLAlchemy, HTML/CSS/JavaScript  
**База данных:** SQLite (легко мигрируется на PostgreSQL)

---

## 🏗 Архитектура проекта

### Компоненты системы

```
┌─────────────────────────────────────────────────────────┐
│                    Клиент (Telegram)                     │
└───────────────┬─────────────────┬───────────────────────┘
                │                 │
        ┌───────▼───────┐ ┌───────▼──────┐
        │  Telegram Bot  │ │  Mini App    │
        │   (aiogram)    │ │  (Web UI)    │
        └───────┬───────┘ └───────┬──────┘
                │                 │
                └────────┬────────┘
                         │
                ┌────────▼────────┐
                │   REST API      │
                │   (FastAPI)     │
                └────────┬────────┘
                         │
                ┌────────▼────────┐
                │   Database      │
                │   (SQLite)      │
                └─────────────────┘
```

---

## 📦 Структура файлов

```
Gryadka/
│
├── bot/                          # Telegram бот
│   ├── handlers/
│   │   ├── basic.py             # Базовые команды (/start, /help)
│   │   ├── admin.py             # Админские команды
│   │   └── __init__.py
│   ├── keyboards/
│   │   ├── inline.py            # Inline клавиатуры
│   │   └── __init__.py
│   ├── main.py                  # Точка входа бота
│   └── __init__.py
│
├── api/                          # REST API
│   ├── routes/
│   │   ├── products.py          # API товаров и категорий
│   │   ├── cart.py              # API корзины и избранного
│   │   ├── orders.py            # API заказов
│   │   ├── admin.py             # Админ API
│   │   ├── common.py            # Общие данные
│   │   └── __init__.py
│   ├── main.py                  # FastAPI приложение
│   └── __init__.py
│
├── mini_app/                     # Telegram Mini App
│   ├── static/
│   │   ├── css/
│   │   │   ├── style.css        # Основные стили
│   │   │   ├── cart.css         # Стили корзины
│   │   │   └── admin/
│   │   │       └── admin.css    # Стили админки
│   │   ├── js/
│   │   │   ├── app.js           # Основной JS
│   │   │   ├── cart.js          # JS корзины
│   │   │   └── admin/
│   │   │       └── admin.js     # JS админки
│   │   ├── images/
│   │   │   ├── logo.png
│   │   │   └── placeholder.jpg
│   │   └── uploads/             # Загруженные файлы
│   ├── templates/
│   │   ├── index.html           # Главная страница
│   │   ├── cart.html            # Корзина
│   │   ├── orders.html          # Заказы
│   │   ├── favorites.html       # Избранное
│   │   ├── profile.html         # Профиль
│   │   └── admin/               # Админ-панель
│   │       ├── index.html
│   │       ├── products.html
│   │       ├── orders.html
│   │       └── settings.html
│   ├── app.py                   # Веб-приложение
│   └── __init__.py
│
├── database/                     # Модели БД
│   ├── models.py                # SQLAlchemy модели
│   ├── database.py              # Настройка БД
│   └── __init__.py
│
├── shared/                       # Общие утилиты
│   ├── config.py                # Конфигурация
│   ├── utils.py                 # Вспомогательные функции
│   └── __init__.py
│
├── .env.example                 # Пример переменных окружения
├── .gitignore                   # Git ignore
├── requirements.txt             # Зависимости Python
├── README.md                    # Краткое описание
├── README_FULL.md               # Полное описание
├── QUICKSTART.md                # Быстрый старт
├── init_db.py                   # Инициализация БД
└── run.py                       # Запуск всех компонентов
```

---

## 💾 Модели базы данных

### Основные таблицы:

1. **users** - Пользователи
   - Telegram ID, имя, телефон
   - Флаг администратора
   - Флаг блокировки

2. **categories** - Категории товаров
   - Название, описание
   - Изображение
   - Порядок сортировки

3. **products** - Товары
   - Название, описание
   - Цены по единицам измерения (кг, шт, уп, ящик)
   - Доступные граммовки
   - Скидки (процент/фикс)
   - Бейджи (хит, акция, советую)
   - Статус наличия

4. **product_images** - Изображения товаров
   - Множественные изображения
   - Флаг главного изображения

5. **orders** - Заказы
   - Номер заказа
   - Данные клиента
   - Доставка (тип, адрес, интервал)
   - Оплата
   - Суммы (товары, доставка, скидка)
   - Статус

6. **order_items** - Позиции заказа
   - Товар, количество, цена

7. **cart_items** - Корзина
   - Товары в корзине пользователя

8. **favorites** - Избранное
   - Избранные товары

9. **promo_codes** - Промокоды
   - Код, скидка
   - Ограничения использования
   - Срок действия

10. **delivery_intervals** - Интервалы доставки
    - Время доставки
    - Время доступности выбора

11. **settings** - Настройки магазина
    - Ключ-значение

12. **faq** - Часто задаваемые вопросы

13. **messages** - Сообщения от клиентов

---

## 🎨 Дизайн

### Цветовая схема:
```css
--primary-green: #4CAF50     /* Основной зеленый */
--accent-orange: #FF9800     /* Акцентный оранжевый */
--background-light: #F5F5F5  /* Светлый фон */
--text-dark: #333333         /* Темный текст */
--text-light: #888888        /* Светлый текст */
--badge-hit: #FFC107         /* Хит */
--badge-sale: #F44336        /* Акция */
```

### UI компоненты:

**Шапка:**
- Логотип + название
- Иконка корзины с счетчиком

**Поиск:**
- Полнотекстовый поиск с иконкой

**Баннеры:**
- 2 колонки (Акции, Хиты)
- Градиентный фон

**Категории:**
- Горизонтальный скролл
- Круглые изображения
- Активное состояние

**Товары:**
- Сетка 2 колонки
- Карточки с изображением
- Бейджи, избранное
- Цена с единицей измерения
- Кнопка "В корзину"

**Навигация:**
- Фиксированная нижняя панель
- 4 раздела (Главная, Избранное, Заказы, Профиль)

---

## 🔐 Безопасность

### Реализованные меры:

1. **Аутентификация:**
   - Через Telegram (initData)
   - Проверка подлинности данных

2. **Авторизация:**
   - Проверка прав администратора по ID
   - Middleware для защиты админских роутов

3. **Валидация:**
   - Pydantic схемы для всех входных данных
   - Проверка типов и форматов

4. **База данных:**
   - SQLAlchemy ORM (защита от SQL-инъекций)
   - Асинхронные запросы

5. **CORS:**
   - Настройка разрешенных источников

---

## 📊 API эндпоинты

### Публичные:

```
GET  /api/products/                    # Список товаров
GET  /api/products/{id}                # Детали товара
GET  /api/products/categories          # Категории
GET  /api/cart/{telegram_id}           # Корзина
POST /api/cart/{telegram_id}           # Добавить в корзину
GET  /api/orders/{telegram_id}         # История заказов
POST /api/orders/create/{telegram_id}  # Создать заказ
GET  /api/delivery-intervals           # Интервалы доставки
GET  /api/settings/public              # Публичные настройки
GET  /api/faq                          # FAQ
GET  /api/server-time                  # Серверное время
```

### Администраторские:

```
POST   /api/admin/products              # Создать товар
PUT    /api/admin/products/{id}         # Обновить товар
DELETE /api/admin/products/{id}         # Удалить товар
POST   /api/admin/products/bulk-update  # Массовое обновление
POST   /api/admin/categories            # Создать категорию
GET    /api/admin/orders                # Все заказы
PUT    /api/admin/orders/{id}/status    # Обновить статус
GET    /api/admin/users                 # Все клиенты
POST   /api/admin/promo-codes           # Создать промокод
POST   /api/admin/delivery-intervals    # Создать интервал
POST   /api/admin/settings              # Обновить настройки
GET    /api/admin/stats                 # Статистика
```

---

## 🚀 Развертывание

### Локально:
```bash
python run.py
```

### Продакшн (пример с nginx):

**1. Установка зависимостей:**
```bash
pip install -r requirements.txt
```

**2. Настройка systemd сервисов:**
- gryadka-bot.service (Telegram бот)
- gryadka-api.service (API)
- gryadka-app.service (Mini App)

**3. Настройка nginx:**
```nginx
server {
    listen 443 ssl;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:8001;
    }
    
    location /api {
        proxy_pass http://localhost:8000;
    }
}
```

---

## 📈 Возможности расширения

### Запланированные функции:

1. **Платежи:**
   - Интеграция Telegram Payments
   - Онлайн-оплата картой

2. **Уведомления:**
   - Push-уведомления о статусе заказа
   - Уведомления о новых акциях

3. **Аналитика:**
   - Детальная статистика продаж
   - Экспорт отчетов в Excel

4. **Маркетинг:**
   - Массовые рассылки
   - Программа лояльности
   - Накопительные скидки

5. **Дополнительно:**
   - Рейтинг товаров
   - Отзывы клиентов
   - Рекомендательная система

---

## 🔧 Настройка и кастомизация

### Изменение дизайна:
Редактируйте файлы в `mini_app/static/css/`

### Добавление полей в модели:
1. Обновите модель в `database/models.py`
2. Создайте миграцию Alembic
3. Обновите API схемы

### Добавление новых страниц:
1. Создайте HTML в `mini_app/templates/`
2. Добавьте роут в `mini_app/app.py`
3. Создайте JS логику в `mini_app/static/js/`

---

## 📞 Контакты и поддержка

Разработано для Farid  
Проект: Грядка  
Дата: Январь 2026

---

Это полнофункциональное решение готово к использованию и может быть легко адаптировано под любые требования бизнеса. 🎉
